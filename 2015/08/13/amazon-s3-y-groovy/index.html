<!DOCTYPE html>
<html lang="en">
<head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# website: http://ogp.me/ns/website#">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta name="description" content="">
    <meta property="og:title" content="Amazon S3 y Groovy">
    
    <meta property="og:type" content="article">
    <meta property="article:published_time" content="2015-08-13">
    
    <meta property="og:description" content="">
    <meta property="og:url" content="http://blog.makingdevs.com/2015/08/13/amazon-s3-y-groovy/">
    <meta property="og:site_name" content="Blog de Making Devs">
    
    <meta name="generator" content="Hugo 0.43-DEV" />
    <title>Amazon S3 y Groovy &middot; Blog de Making Devs</title>
    
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
    <link rel="stylesheet" href="http://blog.makingdevs.com/css/style.css">
    
    <link href="http://blog.makingdevs.com/index.xml" rel="alternate" type="application/rss+xml" title="Blog de Making Devs" />
    
    

    
    
</head>
<body>

<nav class="navbar navbar-default navbar-fixed-top visible-xs">
	<div class="container-fluid">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			
				<a class="navbar-brand" href="http://blog.makingdevs.com/">Blog de Making Devs</a>
			
		</div>
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav">
				
				
			</ul>
		</div>
	</div>
</nav>
<div class="container-fluid">
	<div class="row">
		<div id="menu" class="hidden-xs col-sm-4 col-md-3">
	<div id="menu-content" class="vertical-align">
		
			<h1 class="text-center"><a href="http://blog.makingdevs.com/">Blog de Making Devs</a></h1>
		
		
		
			<small class="text-center center-block">El código que a veces olvidamos documentar.</small>
		
		
		
			<img id="profile-pic" src="http://blog.makingdevs.com//profile.jpeg" alt="My Picture" class="img-circle center-block">
		
		<div id="social" class="text-center">
			

			<a href="mailto:info@makingdevs.com"><i class="fa fa-envelope-o fa-2x"></i></a>
		</div>
		<div id="links" class="text-center">
			
			
		</div>
	</div>
</div>

		<div id="content" class="col-xs-12 col-sm-8 col-md-9">
			<div class="row">
				<div id="post" class="col-sm-offset-1 col-sm-10 col-md-10 col-lg-8">

<main>

  <header>
    <h1 align=center>Amazon S3 y Groovy</h1>
    
    <section class="author">
      <p align=center> <b>Redactado por: José Juan Reyes Zuñiga</b></p>
    </section>
    
  </header>
  </br>

	<article>
		<p>En una de las tareas que realice recientemente, tuve la necesidad de transferir un par de archivos que obtuve de un endpoint(de la cual hablaré en otro post) hacia un Bucket de Amazon S3.</p>

<p>La solución inmediata fue usar una biblioteca que encontré para Java de nombre <a href="http://www.jets3t.org/">jets3t</a>, la cual, provee de un conjunto de herramientas muy simple para operar con Amazon S3, Cloud Front y Google Storage.</p>

<p>El caso muy puntual que tuve que resolver fue subir un archivo y despúes borrarlo de un bucket muy particular. En este ejemplo muestro primero como listar todos los buckets disponibles en una cuenta de S3.</p>

<!-- more -->

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-groovy" data-lang="groovy"><span style="color:#a2f">@Grapes</span><span style="color:#666">(</span>
    <span style="color:#a2f">@Grab</span><span style="color:#666">(</span>group<span style="color:#666">=</span><span style="color:#b44">&#39;net.java.dev.jets3t&#39;</span><span style="color:#666">,</span> module<span style="color:#666">=</span><span style="color:#b44">&#39;jets3t&#39;</span><span style="color:#666">,</span> version<span style="color:#666">=</span><span style="color:#b44">&#39;0.9.3&#39;</span><span style="color:#666">)</span>
<span style="color:#666">)</span>

<span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">org.jets3t.service.security.*</span>
<span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">org.jets3t.service.*</span>
<span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">org.jets3t.service.impl.rest.httpclient.*</span>
<span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">org.jets3t.service.model.*</span>
<span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">org.jets3t.service.acl.*</span>

String awsAccessKey <span style="color:#666">=</span> <span style="color:#b44">&#34;YOURAWSACCESSKEY&#34;</span>
String awsSecretKey <span style="color:#666">=</span> <span style="color:#b44">&#34;YOURAWSSECRETKEY&#34;</span>

AWSCredentials awsCredentials <span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">new</span> <span style="color:#00a000">AWSCredentials</span><span style="color:#666">(</span>awsAccessKey<span style="color:#666">,</span> awsSecretKey<span style="color:#666">)</span>
S3Service s3Service <span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">new</span> <span style="color:#00a000">RestS3Service</span><span style="color:#666">(</span>awsCredentials<span style="color:#666">)</span>

S3Bucket<span style="color:#666">[]</span> myBuckets <span style="color:#666">=</span> s3Service<span style="color:#666">.</span><span style="color:#b44">listAllBuckets</span><span style="color:#666">()</span></code></pre></div>

<p>Despúes, una vez con todos los buckets, podemos listar los archivos contenidos dentro de bucket muy particular.</p>

<p><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-groovy" data-lang="groovy">String bucletName <span style="color:#666">=</span> <span style="color:#b44">&#34;makingdevs-bucket&#34;</span>

bucket <span style="color:#666">=</span> myBuckets<span style="color:#666">.</span><span style="color:#b44">find</span> <span style="color:#666">{</span> it<span style="color:#666">.</span><span style="color:#b44">name</span><span style="color:#666">==</span>bucketName <span style="color:#666">}</span>

s3Objects <span style="color:#666">=</span> s3Service<span style="color:#666">.</span><span style="color:#b44">listObjects</span><span style="color:#666">(</span>bucket<span style="color:#666">)</span></code></pre></div></p>

<p>Finalmente, podemos subir un archivo específico hacia el bucket que deseamos.</p>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-groovy" data-lang="groovy">file <span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">new</span> <span style="color:#00a000">File</span><span style="color:#666">(</span><span style="color:#b44">&#34;/some/file/in/your/filesystem.ext&#34;</span><span style="color:#666">)</span>

S3Object s3Object <span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">new</span> <span style="color:#00a000">S3Object</span><span style="color:#666">()</span>
s3Object<span style="color:#666">.</span><span style="color:#b44">with</span> <span style="color:#666">{</span>
  setAcl AccessControlList<span style="color:#666">.</span><span style="color:#b44">REST_CANNED_PUBLIC_READ</span>
  setContentLength file<span style="color:#666">.</span><span style="color:#b44">length</span><span style="color:#666">()</span>
  setContentType file<span style="color:#666">.</span><span style="color:#b44">toURL</span><span style="color:#666">().</span><span style="color:#b44">openConnection</span><span style="color:#666">().</span><span style="color:#b44">contentType</span>
  setDataInputFile file
  setKey file<span style="color:#666">.</span><span style="color:#b44">name</span>
  setBucketName bucket<span style="color:#666">.</span><span style="color:#b44">getName</span><span style="color:#666">()</span> <span style="color:#080;font-style:italic">// we use our previous bucket
</span><span style="color:#080;font-style:italic"></span><span style="color:#666">}</span>

s3Service<span style="color:#666">.</span><span style="color:#b44">putObject</span> bucket<span style="color:#666">,</span> s3Object</code></pre></div>

<p>Una vez que llamamos al servicio <code>s3Service</code> el archivo queda colocado en el bucket. Y finalmente si deseamos borrarlo podemos usar <code>s3Service.deleteObject s3Bucket, s3Object.key</code>, en donde sólo mandamos el objeto del bucket y el <em>key</em> del objeto que deseamos borrar.</p>

<p>Finalmente, me gustaría detallar dos líneas que en mi opinión son relevantes:</p>

<ul>
<li>La parte de <code>acl AccessControlList.REST_CANNED_PUBLIC_READ</code>, la cual indica que el archivo que se sube es de acceso público para quién quiera que tenga la URL y sólo el propietario puede modificar, existen otras constantes que dan combinaciones de permisos distintos en <a href="http://www.jets3t.org/api/org/jets3t/service/acl/AccessControlList.html">la documentación de JetS3t</a>.</li>
<li>La línea con <code>contentType file.toURL().openConnection().contentType</code> que es una forma de obtener el <em>content type</em> sin la necesidad de una biblioteca adicional, sólo con el uso convencional de las clases Java con las que ya contamos. Les recomiendo tomar cualquier archivo y probar sólo esa línea.</li>
</ul>

<p>Si bien hay más cosas que se pueden hacer, les sugiero se den una vuelta por la documentación de esta biblioteca.</p>

	</article>
</main>

<div id="bottom-nav" class="text-center center-block">
	<a href=" http://blog.makingdevs.com/" class="btn btn-default"><i class="fa fa-home"></i> Home</a>
</div>


  <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "makingdevs" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


						</div>
					</div>
				</div>
			</div>
		</div>
  </div>
  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-42842883-2', 'auto');
    ga('send', 'pageview');
    window.baseURL = "http:\/\/blog.makingdevs.com\/";
  </script>
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.2/js/bootstrap.min.js"></script>
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/topojson/1.6.9/topojson.min.js"></script>
  
  
  <script src="http://blog.makingdevs.com//js/App.js"></script>
  
</body>
</html>
