<!DOCTYPE html>
<html lang="en">
<head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# website: http://ogp.me/ns/website#">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta name="description" content="">
    <meta property="og:title" content="Hot deployment en Gradle">
    
    <meta property="og:type" content="article">
    <meta property="article:published_time" content="2015-07-26">
    
    <meta property="og:description" content="">
    <meta property="og:url" content="http://blog.makingdevs.com/2015/07/26/hot-deployment-en-gradle/">
    <meta property="og:site_name" content="Blog de Making Devs">
    
    <meta property="og:tags" content="groovy">
    
    <meta property="og:tags" content="gradle">
    
    <meta property="og:tags" content="plugins">
    
    <meta name="generator" content="Hugo 0.55.3" />
    <title>Hot deployment en Gradle &middot; Blog de Making Devs</title>
    
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
    <link rel="stylesheet" href="http://blog.makingdevs.com/css/style.css">
    
    <link href="http://blog.makingdevs.com/index.xml" rel="alternate" type="application/rss+xml" title="Blog de Making Devs" />
    
    

    
    
</head>
<body>

<nav class="navbar navbar-default navbar-fixed-top visible-xs">
	<div class="container-fluid">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			
				<a class="navbar-brand" href="http://blog.makingdevs.com/">Blog de Making Devs</a>
			
		</div>
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav">
				
				
			</ul>
		</div>
	</div>
</nav>
<div class="container-fluid">
	<div class="row">
		<div id="menu" class="hidden-xs col-sm-4 col-md-3">
	<div id="menu-content" class="vertical-align">
		
			<h1 class="text-center"><a href="http://blog.makingdevs.com/">Blog de Making Devs</a></h1>
		
		
		
			<small class="text-center center-block">El código que a veces olvidamos documentar.</small>
		
		
		
			<img id="profile-pic" src="http://blog.makingdevs.com//profile.jpeg" alt="My Picture" class="img-circle center-block">
		
		<div id="social" class="text-center">
			

			<a href="mailto:info@makingdevs.com"><i class="fa fa-envelope-o fa-2x"></i></a>
		</div>
		<div id="links" class="text-center">
			
			
		</div>
	</div>
</div>

		<div id="content" class="col-xs-12 col-sm-8 col-md-9">
			<div class="row">
				<div id="post" class="col-sm-offset-1 col-sm-10 col-md-10 col-lg-8">

<main>

  <header>
    <h1 align=center>Hot deployment en Gradle</h1>
    
    <section class="author">
      <p align=center> <b>Redactado por: José Juan Reyes Zuñiga</b></p>
    </section>
    
  </header>
  </br>

	<article>
		<p>Durante un tiempo estuve buscando de la forma de tener una aplicación web con Gradle y tener características como el hot deploy, Grails lo tiene y viendólo de forma interna usa un elemento de nombre <a href="https://github.com/spring-projects/spring-loaded" title="springloaded">SpringLoaded</a>.</p>

<p>Después me di cuenta que frameworks como <a href="https://github.com/spring-projects/spring-loaded" title="dropwizard">Dropwizard</a> lo usan, y que incluso SpringBoot a través del uso del CLI también, investigando un poco más al respecto y por la necesidad de tenerlo listo para algunos proyectos encontré <a href="http://www.cholick.com/entry/show/280" title="tomcat">un artículo</a> en donde explica como ponerlo en acción usando propiamente <a href="https://github.com/spring-projects/spring-loaded" title="dropwizard">Dropwizard</a>. Fue un buen acercamiento, el problema es el siguiente bloque de código en configuración de gradle:
<!-- more --></p>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-groovy" data-lang="groovy">run <span style="color:#666">{</span>
  args <span style="color:#666">=</span> <span style="color:#666">[</span><span style="color:#b44">&#39;server&#39;</span><span style="color:#666">,</span> <span style="color:#b44">&#39;app.yaml&#39;</span><span style="color:#666">]</span>
  jvmArgs <span style="color:#666">=</span> <span style="color:#666">[</span><span style="color:#b44">&#34;-javaagent:${new File(&#34;</span>$buildDir<span style="color:#b44">/agent/</span>springloaded<span style="color:#666">-</span>$<span style="color:#666">{</span>springloadedVersion<span style="color:#666">}.</span><span style="color:#b44">jar</span><span style="color:#b44">&#34;).absolutePath}&#34;</span><span style="color:#666">,</span> <span style="color:#b44">&#39;-noverify&#39;</span><span style="color:#666">]</span>
<span style="color:#666">}</span></code></pre></div>

<p>En donde, el atributo <code>jvmArgs</code> es sólo aplicable a tareas del tipo <code>JavaExec</code>, más específico, que implementan <code>JavaExecSpec</code> o <code>JavaForkOptions</code>. Es aquí en donde <a href="https://github.com/bmuschko/gradle-tomcat-plugin" title="tomcat">el plugin de tomcat</a> que se puede encontrar para Gradle tiene el problema, pues su tarea no lo hace.</p>

<p>La combinación se haría en conjunto con un plugin de gradle, <a href="https://github.com/bluepapa32/gradle-watch-plugin" title="gradle watch">el watch</a>, el actúa con cada cambio en la aplicación realizando las tareas que se le digan. Sin embargo, lo que encontré funcionaba para la cmbinación de SpringBooy e IntelliJ Idea, lo cual no veía mal, pero no era mi caso. De cualquier forma pongo disponible la configuración que independiente me sirvió para hacer un hot deploy usando ambos elementos:</p>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-groovy" data-lang="groovy">apply <span style="color:#a0a000">plugin:</span> <span style="color:#b44">&#39;groovy&#39;</span>
apply <span style="color:#a0a000">plugin:</span> <span style="color:#b44">&#39;spring-boot&#39;</span>
apply <span style="color:#a0a000">plugin:</span> <span style="color:#b44">&#39;com.bluepapa32.watch&#39;</span>

sourceCompatibility <span style="color:#666">=</span> <span style="color:#666">1.8</span>
targetCompatibility <span style="color:#666">=</span> <span style="color:#666">1.8</span>

ext <span style="color:#666">{</span>
  springLoadedVersion <span style="color:#666">=</span> <span style="color:#b44">&#39;1.2.1.RELEASE&#39;</span>
<span style="color:#666">}</span>

mainClassName<span style="color:#666">=</span><span style="color:#b44">&#39;com.makingdevs.Application&#39;</span>

repositories <span style="color:#666">{</span>
  mavenCentral<span style="color:#666">()</span>
  maven <span style="color:#666">{</span>
    url <span style="color:#b44">&#34;https://code.lds.org/nexus/content/groups/main-repo&#34;</span>
  <span style="color:#666">}</span>
<span style="color:#666">}</span>

dependencies <span style="color:#666">{</span>
  compile<span style="color:#666">(</span><span style="color:#b44">&#34;org.springframework.boot:spring-boot-starter-web&#34;</span><span style="color:#666">)</span>
  compile <span style="color:#b44">&#39;org.codehaus.groovy:groovy-all:2.4.3&#39;</span>
<span style="color:#666">}</span>

buildscript <span style="color:#666">{</span>
  repositories <span style="color:#666">{</span>
    mavenCentral<span style="color:#666">()</span>
    jcenter<span style="color:#666">()</span>
  <span style="color:#666">}</span>
  dependencies <span style="color:#666">{</span>
    classpath <span style="color:#b44">&#34;org.springframework.boot:spring-boot-gradle-plugin:1.2.4.RELEASE&#34;</span>
    classpath <span style="color:#b44">&#39;org.springframework:springloaded:1.2.0.RELEASE&#39;</span>
    classpath <span style="color:#b44">&#39;com.bluepapa32:gradle-watch-plugin:0.1.5&#39;</span>
  <span style="color:#666">}</span>
<span style="color:#666">}</span>

jar <span style="color:#666">{</span>
  baseName <span style="color:#666">=</span> <span style="color:#b44">&#39;meerkat-mymapmanager&#39;</span>
  version <span style="color:#666">=</span>  <span style="color:#b44">&#39;0.1.0&#39;</span>
<span style="color:#666">}</span>

compileGroovy <span style="color:#666">{</span>
  <span style="color:#080;font-style:italic">//enable compilation in a separate daemon process
</span><span style="color:#080;font-style:italic"></span>  options<span style="color:#666">.</span><span style="color:#b44">fork</span> <span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">true</span>
<span style="color:#666">}</span>

watch <span style="color:#666">{</span>
  groovy <span style="color:#666">{</span>
    files <span style="color:#00a000">files</span><span style="color:#666">(</span><span style="color:#b44">&#39;src/main/groovy&#39;</span><span style="color:#666">)</span>
    tasks <span style="color:#b44">&#39;compileGroovy&#39;</span>
  <span style="color:#666">}</span>
<span style="color:#666">}</span></code></pre></div>

<p>Al final del día, lo que encontre fue <a href="http://akhikhl.github.io/gretty-doc/index.html" title="gretty">el plugin de Gretty</a>, con el que fácilmente podemos usar un contenedor de Tomcat o Jetty y tener disponible el Hot deploy, creo que tiene algunos detalles de rendimiento pero es útil. Finalmente la configuración se reduce mucho y hay varias tareas disponibles, entre ellas <code>appRun</code>, que es la que levanta el elemento configuraco y lo dijo listo para los cambios:</p>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-groovy" data-lang="groovy"><span style="color:#080;font-style:italic">// Using the new mechanism to include plugins
</span><span style="color:#080;font-style:italic"></span>plugins <span style="color:#666">{</span>
  id <span style="color:#b44">&#39;groovy&#39;</span>
  id <span style="color:#b44">&#39;war&#39;</span>
  id <span style="color:#b44">&#34;org.akhikhl.gretty&#34;</span> version <span style="color:#b44">&#34;1.2.4&#34;</span>
<span style="color:#666">}</span>

repositories <span style="color:#666">{</span>
  mavenCentral<span style="color:#666">()</span>
  jcenter<span style="color:#666">()</span>
<span style="color:#666">}</span>

dependencies <span style="color:#666">{</span>
  compile <span style="color:#b44">&#39;org.codehaus.groovy:groovy-all:2.3.4&#39;</span>
<span style="color:#666">}</span>

gretty <span style="color:#666">{</span>
  <span style="color:#080;font-style:italic">// &#39;jetty7&#39;, &#39;jetty8&#39;, &#39;jetty9&#39;, &#39;tomcat7&#39;, &#39;tomcat8&#39;
</span><span style="color:#080;font-style:italic"></span>  servletContainer <span style="color:#666">=</span> <span style="color:#b44">&#39;tomcat7&#39;</span>
  httpPort <span style="color:#666">=</span> <span style="color:#666">9091</span>
<span style="color:#666">}</span></code></pre></div>

<p>Creo que nos servirá bien un rato para las cosas que tenemos que hcaer, por que incluso soporta SpringBoot.</p>

	</article>
</main>

<div id="bottom-nav" class="text-center center-block">
	<a href=" http://blog.makingdevs.com/" class="btn btn-default"><i class="fa fa-home"></i> Home</a>
</div>


  <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "makingdevs" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


						</div>
					</div>
				</div>
			</div>
		</div>
  </div>
  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-42842883-2', 'auto');
    ga('send', 'pageview');
    window.baseURL = "http:\/\/blog.makingdevs.com\/";
  </script>
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.2/js/bootstrap.min.js"></script>
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/topojson/1.6.9/topojson.min.js"></script>
  
  
  <script src="http://blog.makingdevs.com//js/App.js"></script>
  
</body>
</html>
