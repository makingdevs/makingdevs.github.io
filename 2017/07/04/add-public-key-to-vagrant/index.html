<!DOCTYPE html>
<html lang="en">
<head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# website: http://ogp.me/ns/website#">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta name="description" content="">
    <meta property="og:title" content="Add public key to Vagrant">
    
    <meta property="og:type" content="article">
    <meta property="article:published_time" content="2017-07-04">
    
    <meta property="og:description" content="">
    <meta property="og:url" content="http://blog.makingdevs.com/2017/07/04/add-public-key-to-vagrant/">
    <meta property="og:site_name" content="Blog de Making Devs">
    
    <meta property="og:tags" content="operations">
    
    <meta property="og:tags" content="vagrant">
    
    <meta property="og:tags" content="virtual box">
    
    <meta property="og:tags" content="developer tools">
    
    <meta property="og:tags" content="public key">
    
    <meta name="generator" content="Hugo 0.47.1" />
    <title>Add public key to Vagrant &middot; Blog de Making Devs</title>
    
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/styles/default.min.css">
    
    <link rel="stylesheet" href="http://blog.makingdevs.com/css/style.css">
    
    <link href="http://blog.makingdevs.com/index.xml" rel="alternate" type="application/rss+xml" title="Blog de Making Devs" />
    
    

    
    
</head>
<body>

<nav class="navbar navbar-default navbar-fixed-top visible-xs">
	<div class="container-fluid">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			
				<a class="navbar-brand" href="http://blog.makingdevs.com/">Blog de Making Devs</a>
			
		</div>
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav">
				
				
			</ul>
		</div>
	</div>
</nav>
<div class="container-fluid">
	<div class="row">
		<div id="menu" class="hidden-xs col-sm-4 col-md-3">
	<div id="menu-content" class="vertical-align">
		
			<h1 class="text-center"><a href="http://blog.makingdevs.com/">Blog de Making Devs</a></h1>
		
		
		
			<small class="text-center center-block">El código que a veces olvidamos documentar.</small>
		
		
		
			<img id="profile-pic" src="http://blog.makingdevs.com//profile.jpeg" alt="My Picture" class="img-circle center-block">
		
		<div id="social" class="text-center">
			

			<a href="mailto:info@makingdevs.com"><i class="fa fa-envelope-o fa-2x"></i></a>
		</div>
		<div id="links" class="text-center">
			
			
		</div>
	</div>
</div>

		<div id="content" class="col-xs-12 col-sm-8 col-md-9">
			<div class="row">
				<div id="post" class="col-sm-offset-1 col-sm-10 col-md-10 col-lg-8">

<main>

  <header>
    <h1 align=center>Add public key to Vagrant</h1>
    
    <section class="author">
      <p align=center> <b>Redactado por: Felipe Juarez</b></p>
    </section>
    
  </header>
  </br>

	<article>
		<p>After copying a <a href="http://blog.makingdevs.com/2017/06/18/copying-files-to-vagrant/">file</a> to <code>Vagrant</code> and creating a basic <a href="http://blog.makingdevs.com/2017/06/01/creating-virtual-machines-with-vagrant/">file structure</a>. We can continue with our series.</p>

<p>So, in this post, we are going to talk about the following topics:</p>

<ol>
<li>Assign an IP address</li>
<li>Add your public key</li>
<li>Access to vagrant machine without <code>vagrant ssh</code></li>
</ol>

<p>For the first point and taking the <a href="http://blog.makingdevs.com/2017/06/01/creating-virtual-machines-with-vagrant/">file structure</a> previously mentioned, we modify as follow:</p>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">Vagrant.configure<span style="color:#666">(</span><span style="color:#b44">&#34;2&#34;</span><span style="color:#666">)</span> <span style="color:#a2f;font-weight:bold">do</span> |config|
  config.vm.box <span style="color:#666">=</span> <span style="color:#b44">&#34;centos/7&#34;</span>

  config.vm.network <span style="color:#b44">&#34;public_network&#34;</span>, bridge: <span style="color:#b44">&#34;en0: Wi-Fi (AirPort)&#34;</span>, auto_config: <span style="color:#a2f">false</span>
  config.vm.provision <span style="color:#b44">&#34;shell&#34;</span>, run: <span style="color:#b44">&#34;always&#34;</span>, inline: <span style="color:#b44">&#34;ip addr add 192.168.15.200 dev eth1&#34;</span>
end</code></pre></div>

<p>Once we have finished editing that file, we run <code>vagrant up</code> command. We can test our configuration two different ways. The first one is using <code>ping</code> command:</p>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">❯ ping -c <span style="color:#666">6</span> <span style="color:#666">192</span>.168.15.200
PING <span style="color:#666">192</span>.168.15.200 <span style="color:#666">(</span><span style="color:#666">192</span>.168.15.200<span style="color:#666">)</span>: <span style="color:#666">56</span> data bytes
<span style="color:#666">64</span> bytes from <span style="color:#666">192</span>.168.15.200: <span style="color:#b8860b">icmp_seq</span><span style="color:#666">=</span><span style="color:#666">0</span> <span style="color:#b8860b">ttl</span><span style="color:#666">=</span><span style="color:#666">64</span> <span style="color:#b8860b">time</span><span style="color:#666">=</span><span style="color:#666">0</span>.265 ms
<span style="color:#666">64</span> bytes from <span style="color:#666">192</span>.168.15.200: <span style="color:#b8860b">icmp_seq</span><span style="color:#666">=</span><span style="color:#666">1</span> <span style="color:#b8860b">ttl</span><span style="color:#666">=</span><span style="color:#666">64</span> <span style="color:#b8860b">time</span><span style="color:#666">=</span><span style="color:#666">0</span>.361 ms
<span style="color:#666">64</span> bytes from <span style="color:#666">192</span>.168.15.200: <span style="color:#b8860b">icmp_seq</span><span style="color:#666">=</span><span style="color:#666">2</span> <span style="color:#b8860b">ttl</span><span style="color:#666">=</span><span style="color:#666">64</span> <span style="color:#b8860b">time</span><span style="color:#666">=</span><span style="color:#666">0</span>.474 ms
<span style="color:#666">64</span> bytes from <span style="color:#666">192</span>.168.15.200: <span style="color:#b8860b">icmp_seq</span><span style="color:#666">=</span><span style="color:#666">3</span> <span style="color:#b8860b">ttl</span><span style="color:#666">=</span><span style="color:#666">64</span> <span style="color:#b8860b">time</span><span style="color:#666">=</span><span style="color:#666">0</span>.555 ms
<span style="color:#666">64</span> bytes from <span style="color:#666">192</span>.168.15.200: <span style="color:#b8860b">icmp_seq</span><span style="color:#666">=</span><span style="color:#666">4</span> <span style="color:#b8860b">ttl</span><span style="color:#666">=</span><span style="color:#666">64</span> <span style="color:#b8860b">time</span><span style="color:#666">=</span><span style="color:#666">0</span>.380 ms
<span style="color:#666">64</span> bytes from <span style="color:#666">192</span>.168.15.200: <span style="color:#b8860b">icmp_seq</span><span style="color:#666">=</span><span style="color:#666">5</span> <span style="color:#b8860b">ttl</span><span style="color:#666">=</span><span style="color:#666">64</span> <span style="color:#b8860b">time</span><span style="color:#666">=</span><span style="color:#666">0</span>.334 ms

--- <span style="color:#666">192</span>.168.15.200 ping statistics ---
<span style="color:#666">6</span> packets transmitted, <span style="color:#666">6</span> packets received, <span style="color:#666">0</span>.0% packet loss
round-trip min/avg/max/stddev <span style="color:#666">=</span> <span style="color:#666">0</span>.265/0.395/0.555/0.095 ms</code></pre></div>

<p>And the second one is using <code>vagrant ssh</code> and checking the interface:</p>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">❯ vagrant ssh
Last login: Wed Jul  <span style="color:#666">5</span> <span style="color:#666">04</span>:07:21 <span style="color:#666">2017</span> from <span style="color:#666">10</span>.0.2.2
<span style="color:#666">[</span>vagrant@localhost ~<span style="color:#666">]</span>$ ip addr show eth1
<span style="color:#666">3</span>: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span style="color:#666">1500</span> qdisc pfifo_fast state UP qlen <span style="color:#666">1000</span>
    link/ether <span style="color:#666">08</span>:00:27:e5:b5:69 brd ff:ff:ff:ff:ff:ff
    inet <span style="color:#666">192</span>.168.15.12/24 brd <span style="color:#666">192</span>.168.15.255 scope global dynamic eth1
       valid_lft 86031sec preferred_lft 86031sec
    inet <span style="color:#666">192</span>.168.15.200/32 scope global eth1
       valid_lft forever preferred_lft forever
    inet6 fe80::a9a0:340d:44ab:6ed1/64 scope link
       valid_lft forever preferred_lft forever</code></pre></div>

<p>With that in place, we are going to add our <code>public key</code> (if you don&rsquo;t know how create one you can check <a href="https://help.github.com/articles/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent/">this github post</a>). So, we edit our <code>Vagrant</code> file again, as follows:</p>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">Vagrant.configure<span style="color:#666">(</span><span style="color:#b44">&#34;2&#34;</span><span style="color:#666">)</span> <span style="color:#a2f;font-weight:bold">do</span> |config|
  config.vm.box <span style="color:#666">=</span> <span style="color:#b44">&#34;centos/7&#34;</span>

  config.vm.network <span style="color:#b44">&#34;public_network&#34;</span>, bridge: <span style="color:#b44">&#34;en0: Wi-Fi (AirPort)&#34;</span>, auto_config: <span style="color:#a2f">false</span>
  config.vm.provision <span style="color:#b44">&#34;shell&#34;</span>, run: <span style="color:#b44">&#34;always&#34;</span>, inline: <span style="color:#b44">&#34;ip addr add 192.168.15.200 dev eth1&#34;</span>

  config.ssh.insert_key <span style="color:#666">=</span> <span style="color:#a2f">false</span> <span style="color:#080;font-style:italic"># 1
</span><span style="color:#080;font-style:italic"></span>  config.ssh.private_key_path <span style="color:#666">=</span> <span style="color:#666">[</span><span style="color:#b44">&#39;~/.vagrant.d/insecure_private_key&#39;</span>, <span style="color:#b44">&#39;~/.ssh/id_rsa&#39;</span><span style="color:#666">]</span> <span style="color:#080;font-style:italic"># 2
</span><span style="color:#080;font-style:italic"></span>  config.vm.provision <span style="color:#b44">&#34;file&#34;</span>, source: <span style="color:#b44">&#34;~/.ssh/id_rsa.pub&#34;</span>, destination: <span style="color:#b44">&#34;~/.ssh/authorized_keys&#34;</span> <span style="color:#080;font-style:italic"># 3
</span><span style="color:#080;font-style:italic"></span>
  <span style="color:#080;font-style:italic"># 4
</span><span style="color:#080;font-style:italic"></span>  config.vm.provision <span style="color:#b44">&#34;shell&#34;</span>, inline: <span style="color:#b44">&lt;&lt;-EOC
</span><span style="color:#b44">    sudo sed -i -e &#34;\\#PasswordAuthentication yes# s#PasswordAuthentication yes#PasswordAuthentication no#g&#34; /etc/ssh/sshd_config
</span><span style="color:#b44">    sudo systemctl restart sshd.service
</span><span style="color:#b44">    echo &#34;finished&#34;
</span><span style="color:#b44">  EOC</span>
end</code></pre></div>

<p>In line marked with <code>1</code> we tell to <code>Vagrant</code> that use Vagrant&rsquo;s default insecure key inside the machine. In the next line (<code>2</code>) we specify the paths to the private keys to use to SSH into the guest machine. In step number <code>3</code> we copy our <code>id_rsa.pub</code> into the <code>Vagrant</code> machine and rename as <code>authorized_keys</code>. And finally, in step <code>4</code> we change the configuration of <code>sshd</code>, for not asking a password and restart our service.</p>

<p>Finally we can access to our <code>Vagrant</code> machine with pure <code>ssh vagrant@192.168.15.200</code>.</p>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">❯ ssh vagrant@192.168.15.200
The authenticity of host <span style="color:#b44">&#39;192.168.15.200 (192.168.15.200)&#39;</span> can<span style="color:#b44">&#39;t be established.
</span><span style="color:#b44">ECDSA key fingerprint is SHA256:d5Ak9sY7Gg1biVuQJ1Gdp6Axan3uq5+EkwMaoGSNQZw.
</span><span style="color:#b44">Are you sure you want to continue connecting (yes/no)? yes
</span><span style="color:#b44">Warning: Permanently added &#39;</span><span style="color:#666">192</span>.168.15.200<span style="">&#39;</span> <span style="color:#666">(</span>ECDSA<span style="color:#666">)</span> to the list of known hosts.
Last login: Wed Jul  <span style="color:#666">5</span> <span style="color:#666">04</span>:37:17 <span style="color:#666">2017</span> from <span style="color:#666">10</span>.0.2.2
<span style="color:#666">[</span>vagrant@localhost ~<span style="color:#666">]</span>$</code></pre></div>

<p>And that&rsquo;s all, with this you can access to the machine without password. And in the next post we are going to talk about <code>distillery</code>.</p>

	</article>
</main>

<div id="bottom-nav" class="text-center center-block">
	<a href=" http://blog.makingdevs.com/" class="btn btn-default"><i class="fa fa-home"></i> Home</a>
</div>


  <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "makingdevs" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


						</div>
					</div>
				</div>
			</div>
		</div>
  </div>
  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-42842883-2', 'auto');
    ga('send', 'pageview');
    window.baseURL = "http:\/\/blog.makingdevs.com\/";
  </script>
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.2/js/bootstrap.min.js"></script>
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/topojson/1.6.9/topojson.min.js"></script>
  
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/highlight.min.js"></script>
  
  <script src="http://blog.makingdevs.com//js/App.js"></script>
  
</body>
</html>
