<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Blog de Making Devs</title>
    <link>http://blog.makingdevs.com/tags/ecto/index.xml</link>
    <description>Recent content on Blog de Making Devs</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <atom:link href="http://blog.makingdevs.com/tags/ecto/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Ecto Transactions</title>
      <link>http://blog.makingdevs.com/2016/09/20/ecto-transactions</link>
      <pubDate>Tue, 20 Sep 2016 19:35:08 -0500</pubDate>
      
      <guid>http://blog.makingdevs.com/2016/09/20/ecto-transactions</guid>
      <description>&lt;p&gt;It has been a couple of months since I wrote something and was about &lt;code&gt;phoenix&lt;/code&gt; and &lt;code&gt;bootstrap&lt;/code&gt;. Today I&amp;rsquo;m going to talk about &lt;code&gt;elixir&lt;/code&gt;, &lt;code&gt;ecto&lt;/code&gt; and how to manage &lt;code&gt;transactions&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Well in this post we are going to skip &lt;code&gt;ecto setup&lt;/code&gt; (if for some way, it was need it, please leave a comment and I will make a post for it, but I think his &lt;a href=&#34;https://github.com/elixir-ecto/ecto&#34;&gt;documentation&lt;/a&gt; makes a fairly good example for it)&lt;/p&gt;

&lt;p&gt;With that in mind, these are the tables that we are going to use.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Project table
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;defmodule&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;EctoTransactions.Project&lt;/span&gt; &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;do&lt;/span&gt;
  &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;use&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;Ecto.Schema&lt;/span&gt;
  &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;Ecto.Changeset&lt;/span&gt;

  schema &lt;span style=&#34;color: #BB4444&#34;&gt;&amp;quot;projects&amp;quot;&lt;/span&gt; &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;do&lt;/span&gt;
    field &lt;span style=&#34;color: #B8860B&#34;&gt;:name&lt;/span&gt;
    has_many &lt;span style=&#34;color: #B8860B&#34;&gt;:tasks&lt;/span&gt;, &lt;span style=&#34;color: #0000FF&#34;&gt;EctoTransactions.Task&lt;/span&gt;

    timestamps
  &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;end&lt;/span&gt;

  &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;def&lt;/span&gt; changeset(struct, params \\ %{}) &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;do&lt;/span&gt;
    struct
    &lt;span style=&#34;color: #666666&#34;&gt;|&amp;gt;&lt;/span&gt; cast(params, [&lt;span style=&#34;color: #B8860B&#34;&gt;:name&lt;/span&gt;])
    &lt;span style=&#34;color: #666666&#34;&gt;|&amp;gt;&lt;/span&gt; validate_required([&lt;span style=&#34;color: #B8860B&#34;&gt;:name&lt;/span&gt;])
  &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;end&lt;/span&gt;

&lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Task table
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;defmodule&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;EctoTransactions.Task&lt;/span&gt; &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;do&lt;/span&gt;
  &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;use&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;Ecto.Schema&lt;/span&gt;

  &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;Ecto.Changeset&lt;/span&gt;

  schema &lt;span style=&#34;color: #BB4444&#34;&gt;&amp;quot;tasks&amp;quot;&lt;/span&gt; &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;do&lt;/span&gt;
    field &lt;span style=&#34;color: #B8860B&#34;&gt;:description&lt;/span&gt;
    belongs_to &lt;span style=&#34;color: #B8860B&#34;&gt;:project&lt;/span&gt;, &lt;span style=&#34;color: #0000FF&#34;&gt;EctoTransactions.Project&lt;/span&gt;

    timestamps
  &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;end&lt;/span&gt;

  &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;def&lt;/span&gt; changeset(struct, params \\ %{}) &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;do&lt;/span&gt;
    struct
    &lt;span style=&#34;color: #666666&#34;&gt;|&amp;gt;&lt;/span&gt; cast(params, [&lt;span style=&#34;color: #B8860B&#34;&gt;:description&lt;/span&gt;, &lt;span style=&#34;color: #B8860B&#34;&gt;:project_id&lt;/span&gt;])
    &lt;span style=&#34;color: #666666&#34;&gt;|&amp;gt;&lt;/span&gt; validate_required([&lt;span style=&#34;color: #B8860B&#34;&gt;:description&lt;/span&gt;, &lt;span style=&#34;color: #B8860B&#34;&gt;:project_id&lt;/span&gt;])
  &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;end&lt;/span&gt;
&lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;With both tables we can see that &lt;code&gt;Task&lt;/code&gt; depends from &lt;code&gt;Project&lt;/code&gt;. So we are going to create a &lt;code&gt;project&lt;/code&gt; with a &lt;code&gt;task&lt;/code&gt; and we are going to see how can we handle a creation like that.&lt;/p&gt;

&lt;p&gt;The first thing we should know is, how can we create a transaction? With this instruction &lt;code&gt;Repo.transaction(fn -&amp;gt; end)&lt;/code&gt; Between &lt;code&gt;arrow&lt;/code&gt; and &lt;code&gt;end&lt;/code&gt; we put the code that we need. And for making a &lt;code&gt;rollback&lt;/code&gt; we use &lt;code&gt;Repo.rollback(value)&lt;/code&gt; and between parenthesis we can indicate the reason of why we are making that decision.&lt;/p&gt;

&lt;p&gt;So we are going to create a module for handling this&lt;/p&gt;

&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;  &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;defmodule&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;EctoTransactions.App&lt;/span&gt; &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;do&lt;/span&gt;

    &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;Ecto&lt;/span&gt;
    &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;alias&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;EctoTransactions.Repo&lt;/span&gt;
    &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;alias&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;EctoTransactions.Project&lt;/span&gt;
    &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;alias&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;EctoTransactions.Task&lt;/span&gt;

    &lt;span style=&#34;color: #008800; font-style: italic&#34;&gt;# creating project and task&lt;/span&gt;
    &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;def&lt;/span&gt; create_project_with_task(project_params, task_params) &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;do&lt;/span&gt;
      &lt;span style=&#34;color: #0000FF&#34;&gt;Repo&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;transaction(&lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;fn&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;-&amp;gt;&lt;/span&gt;
        project_params
        &lt;span style=&#34;color: #666666&#34;&gt;|&amp;gt;&lt;/span&gt; create_project_with_params
        &lt;span style=&#34;color: #666666&#34;&gt;|&amp;gt;&lt;/span&gt; add_task_to_project(task_params)
      &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;end&lt;/span&gt;)
    &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;end&lt;/span&gt;

    &lt;span style=&#34;color: #008800; font-style: italic&#34;&gt;# creating project&lt;/span&gt;
    &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;defp&lt;/span&gt; create_project_with_params(project_params) &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;do&lt;/span&gt;
      %&lt;span style=&#34;color: #0000FF&#34;&gt;Project&lt;/span&gt;{}
      &lt;span style=&#34;color: #666666&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;Project&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;changeset(project_params)
      &lt;span style=&#34;color: #666666&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;Repo&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;insert
    &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;end&lt;/span&gt;

    &lt;span style=&#34;color: #008800; font-style: italic&#34;&gt;# adding a task to a valid project&lt;/span&gt;
    &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;defp&lt;/span&gt; add_task_to_project({&lt;span style=&#34;color: #B8860B&#34;&gt;:ok&lt;/span&gt;, project}, task_params) &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;do&lt;/span&gt;
      changeset &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; project
                  &lt;span style=&#34;color: #666666&#34;&gt;|&amp;gt;&lt;/span&gt; build_assoc(&lt;span style=&#34;color: #B8860B&#34;&gt;:tasks&lt;/span&gt;)
                  &lt;span style=&#34;color: #666666&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;Task&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;changeset(task_params)

      &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;Repo&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;insert(changeset) &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;do&lt;/span&gt;
        {&lt;span style=&#34;color: #B8860B&#34;&gt;:ok&lt;/span&gt;, _task} &lt;span style=&#34;color: #666666&#34;&gt;-&amp;gt;&lt;/span&gt; project
        {&lt;span style=&#34;color: #B8860B&#34;&gt;:error&lt;/span&gt;, changeset} &lt;span style=&#34;color: #666666&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;Repo&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;rollback(&lt;span style=&#34;color: #B8860B&#34;&gt;:task&lt;/span&gt;) &lt;span style=&#34;color: #008800; font-style: italic&#34;&gt;# Rollback transaction for invalid task data&lt;/span&gt;
      &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;end&lt;/span&gt;
    &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;end&lt;/span&gt;
    &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;defp&lt;/span&gt; add_task_to_project({&lt;span style=&#34;color: #B8860B&#34;&gt;:error&lt;/span&gt;, _changeset}, _task_params),
    &lt;span style=&#34;color: #B8860B&#34;&gt;do&lt;/span&gt;: &lt;span style=&#34;color: #0000FF&#34;&gt;Repo&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;rollback(&lt;span style=&#34;color: #B8860B&#34;&gt;:project&lt;/span&gt;) &lt;span style=&#34;color: #008800; font-style: italic&#34;&gt;# Rollback transaction for invalid project data&lt;/span&gt;

  &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;So if we use &lt;code&gt;iex -S mix&lt;/code&gt; and passing some args to this we can obtain the following results&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Passing good options
&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;iex(&lt;span style=&#34;color: #666666&#34;&gt;1&lt;/span&gt;)&lt;span style=&#34;color: #666666&#34;&gt;&amp;gt;&lt;/span&gt; project_params &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; %{&lt;span style=&#34;color: #B8860B&#34;&gt;name&lt;/span&gt;: &lt;span style=&#34;color: #BB4444&#34;&gt;&amp;quot;Explain ecto transactions&amp;quot;&lt;/span&gt;}
%{&lt;span style=&#34;color: #B8860B&#34;&gt;name&lt;/span&gt;: &lt;span style=&#34;color: #BB4444&#34;&gt;&amp;quot;Explain ecto transactions&amp;quot;&lt;/span&gt;}
iex(&lt;span style=&#34;color: #666666&#34;&gt;2&lt;/span&gt;)&lt;span style=&#34;color: #666666&#34;&gt;&amp;gt;&lt;/span&gt; task_params &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; %{&lt;span style=&#34;color: #B8860B&#34;&gt;description&lt;/span&gt;: &lt;span style=&#34;color: #BB4444&#34;&gt;&amp;quot;Should create task for example&amp;quot;&lt;/span&gt;}
%{&lt;span style=&#34;color: #B8860B&#34;&gt;description&lt;/span&gt;: &lt;span style=&#34;color: #BB4444&#34;&gt;&amp;quot;Should create task for example&amp;quot;&lt;/span&gt;}
iex(&lt;span style=&#34;color: #666666&#34;&gt;3&lt;/span&gt;)&lt;span style=&#34;color: #666666&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;EctoTransactions.App&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;create_project_with_task(project_params, task_params)

&lt;span style=&#34;color: #666666&#34;&gt;22&lt;/span&gt;:&lt;span style=&#34;color: #666666&#34;&gt;28&lt;/span&gt;:&lt;span style=&#34;color: #666666&#34;&gt;59.905&lt;/span&gt; [debug] &lt;span style=&#34;color: #0000FF&#34;&gt;QUERY&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;OK&lt;/span&gt; db&lt;span style=&#34;color: #666666&#34;&gt;=0.2&lt;/span&gt;ms queue&lt;span style=&#34;color: #666666&#34;&gt;=0.1&lt;/span&gt;ms
begin []

&lt;span style=&#34;color: #666666&#34;&gt;22&lt;/span&gt;:&lt;span style=&#34;color: #666666&#34;&gt;28&lt;/span&gt;:&lt;span style=&#34;color: #666666&#34;&gt;59.917&lt;/span&gt; [debug] &lt;span style=&#34;color: #0000FF&#34;&gt;QUERY&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;OK&lt;/span&gt; db&lt;span style=&#34;color: #666666&#34;&gt;=0.9&lt;/span&gt;ms
&lt;span style=&#34;color: #0000FF&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;INTO&lt;/span&gt; &lt;span style=&#34;color: #BB4444&#34;&gt;&amp;quot;projects&amp;quot;&lt;/span&gt; (&lt;span style=&#34;color: #BB4444&#34;&gt;&amp;quot;name&amp;quot;&lt;/span&gt;,&lt;span style=&#34;color: #BB4444&#34;&gt;&amp;quot;inserted_at&amp;quot;&lt;/span&gt;,&lt;span style=&#34;color: #BB4444&#34;&gt;&amp;quot;updated_at&amp;quot;&lt;/span&gt;) &lt;span style=&#34;color: #0000FF&#34;&gt;VALUES&lt;/span&gt; (&lt;span style=&#34;border: 1px solid #FF0000&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;1&lt;/span&gt;,&lt;span style=&#34;border: 1px solid #FF0000&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;2&lt;/span&gt;,&lt;span style=&#34;border: 1px solid #FF0000&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;3&lt;/span&gt;) &lt;span style=&#34;color: #0000FF&#34;&gt;RETURNING&lt;/span&gt; &lt;span style=&#34;color: #BB4444&#34;&gt;&amp;quot;id&amp;quot;&lt;/span&gt; [&lt;span style=&#34;color: #BB4444&#34;&gt;&amp;quot;Explain ecto transactions&amp;quot;&lt;/span&gt;, {{&lt;span style=&#34;color: #666666&#34;&gt;2016&lt;/span&gt;, &lt;span style=&#34;color: #666666&#34;&gt;9&lt;/span&gt;, &lt;span style=&#34;color: #666666&#34;&gt;21&lt;/span&gt;}, {&lt;span style=&#34;color: #666666&#34;&gt;3&lt;/span&gt;, &lt;span style=&#34;color: #666666&#34;&gt;28&lt;/span&gt;, &lt;span style=&#34;color: #666666&#34;&gt;59&lt;/span&gt;, &lt;span style=&#34;color: #666666&#34;&gt;0&lt;/span&gt;}}, {{&lt;span style=&#34;color: #666666&#34;&gt;2016&lt;/span&gt;, &lt;span style=&#34;color: #666666&#34;&gt;9&lt;/span&gt;, &lt;span style=&#34;color: #666666&#34;&gt;21&lt;/span&gt;}, {&lt;span style=&#34;color: #666666&#34;&gt;3&lt;/span&gt;, &lt;span style=&#34;color: #666666&#34;&gt;28&lt;/span&gt;, &lt;span style=&#34;color: #666666&#34;&gt;59&lt;/span&gt;, &lt;span style=&#34;color: #666666&#34;&gt;0&lt;/span&gt;}}]

&lt;span style=&#34;color: #666666&#34;&gt;22&lt;/span&gt;:&lt;span style=&#34;color: #666666&#34;&gt;28&lt;/span&gt;:&lt;span style=&#34;color: #666666&#34;&gt;59.921&lt;/span&gt; [debug] &lt;span style=&#34;color: #0000FF&#34;&gt;QUERY&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;OK&lt;/span&gt; db&lt;span style=&#34;color: #666666&#34;&gt;=3.1&lt;/span&gt;ms
&lt;span style=&#34;color: #0000FF&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;INTO&lt;/span&gt; &lt;span style=&#34;color: #BB4444&#34;&gt;&amp;quot;tasks&amp;quot;&lt;/span&gt; (&lt;span style=&#34;color: #BB4444&#34;&gt;&amp;quot;description&amp;quot;&lt;/span&gt;,&lt;span style=&#34;color: #BB4444&#34;&gt;&amp;quot;project_id&amp;quot;&lt;/span&gt;,&lt;span style=&#34;color: #BB4444&#34;&gt;&amp;quot;inserted_at&amp;quot;&lt;/span&gt;,&lt;span style=&#34;color: #BB4444&#34;&gt;&amp;quot;updated_at&amp;quot;&lt;/span&gt;) &lt;span style=&#34;color: #0000FF&#34;&gt;VALUES&lt;/span&gt; (&lt;span style=&#34;border: 1px solid #FF0000&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;1&lt;/span&gt;,&lt;span style=&#34;border: 1px solid #FF0000&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;2&lt;/span&gt;,&lt;span style=&#34;border: 1px solid #FF0000&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;3&lt;/span&gt;,&lt;span style=&#34;border: 1px solid #FF0000&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;4&lt;/span&gt;) &lt;span style=&#34;color: #0000FF&#34;&gt;RETURNING&lt;/span&gt; &lt;span style=&#34;color: #BB4444&#34;&gt;&amp;quot;id&amp;quot;&lt;/span&gt; [&lt;span style=&#34;color: #BB4444&#34;&gt;&amp;quot;Should create task for example&amp;quot;&lt;/span&gt;, &lt;span style=&#34;color: #666666&#34;&gt;1&lt;/span&gt;, {{&lt;span style=&#34;color: #666666&#34;&gt;2016&lt;/span&gt;, &lt;span style=&#34;color: #666666&#34;&gt;9&lt;/span&gt;, &lt;span style=&#34;color: #666666&#34;&gt;21&lt;/span&gt;}, {&lt;span style=&#34;color: #666666&#34;&gt;3&lt;/span&gt;, &lt;span style=&#34;color: #666666&#34;&gt;28&lt;/span&gt;, &lt;span style=&#34;color: #666666&#34;&gt;59&lt;/span&gt;, &lt;span style=&#34;color: #666666&#34;&gt;0&lt;/span&gt;}}, {{&lt;span style=&#34;color: #666666&#34;&gt;2016&lt;/span&gt;, &lt;span style=&#34;color: #666666&#34;&gt;9&lt;/span&gt;, &lt;span style=&#34;color: #666666&#34;&gt;21&lt;/span&gt;}, {&lt;span style=&#34;color: #666666&#34;&gt;3&lt;/span&gt;, &lt;span style=&#34;color: #666666&#34;&gt;28&lt;/span&gt;, &lt;span style=&#34;color: #666666&#34;&gt;59&lt;/span&gt;, &lt;span style=&#34;color: #666666&#34;&gt;0&lt;/span&gt;}}]

&lt;span style=&#34;color: #666666&#34;&gt;22&lt;/span&gt;:&lt;span style=&#34;color: #666666&#34;&gt;28&lt;/span&gt;:&lt;span style=&#34;color: #666666&#34;&gt;59.922&lt;/span&gt; [debug] &lt;span style=&#34;color: #0000FF&#34;&gt;QUERY&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;OK&lt;/span&gt; db&lt;span style=&#34;color: #666666&#34;&gt;=0.3&lt;/span&gt;ms
commit []
{&lt;span style=&#34;color: #B8860B&#34;&gt;:ok&lt;/span&gt;,
 %&lt;span style=&#34;color: #0000FF&#34;&gt;EctoTransactions.Project&lt;/span&gt;{&lt;span style=&#34;color: #B8860B&#34;&gt;__meta__&lt;/span&gt;: &lt;span style=&#34;color: #008800; font-style: italic&#34;&gt;#Ecto.Schema.Metadata&amp;lt;:loaded, &amp;quot;projects&amp;quot;&amp;gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #B8860B&#34;&gt;id&lt;/span&gt;: &lt;span style=&#34;color: #666666&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color: #B8860B&#34;&gt;inserted_at&lt;/span&gt;: &lt;span style=&#34;color: #008800; font-style: italic&#34;&gt;#Ecto.DateTime&amp;lt;2016-09-21 03:28:59&amp;gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #B8860B&#34;&gt;name&lt;/span&gt;: &lt;span style=&#34;color: #BB4444&#34;&gt;&amp;quot;Explain ecto transactions&amp;quot;&lt;/span&gt;,
  &lt;span style=&#34;color: #B8860B&#34;&gt;tasks&lt;/span&gt;: &lt;span style=&#34;color: #008800; font-style: italic&#34;&gt;#Ecto.Association.NotLoaded&amp;lt;association :tasks is not loaded&amp;gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #B8860B&#34;&gt;updated_at&lt;/span&gt;: &lt;span style=&#34;color: #008800; font-style: italic&#34;&gt;#Ecto.DateTime&amp;lt;2016-09-21 03:28:59&amp;gt;}}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;ecto_simple&lt;span style=&#34;color: #666666&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;select&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;from&lt;/span&gt; projects; &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;select&lt;/span&gt; &lt;span style=&#34;color: #666666&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #AA22FF; font-weight: bold&#34;&gt;from&lt;/span&gt; tasks;
&lt;span style=&#34;color: #888888&#34;&gt;+------+---------------------------+---------------------+---------------------+&lt;/span&gt;
&lt;span style=&#34;color: #888888&#34;&gt;|   id | name                      | inserted_at         | updated_at          |&lt;/span&gt;
&lt;span style=&#34;color: #888888&#34;&gt;|------+---------------------------+---------------------+---------------------|&lt;/span&gt;
&lt;span style=&#34;color: #888888&#34;&gt;|    1 | Explain ecto transactions | 2016-09-21 03:28:59 | 2016-09-21 03:28:59 |&lt;/span&gt;
&lt;span style=&#34;color: #888888&#34;&gt;+------+---------------------------+---------------------+---------------------+&lt;/span&gt;
&lt;span style=&#34;color: #888888&#34;&gt;SELECT 1&lt;/span&gt;
&lt;span style=&#34;color: #888888&#34;&gt;+------+--------------------------------+--------------+---------------------+---------------------+&lt;/span&gt;
&lt;span style=&#34;color: #888888&#34;&gt;|   id | description                    |   project_id | inserted_at         | updated_at          |&lt;/span&gt;
&lt;span style=&#34;color: #888888&#34;&gt;|------+--------------------------------+--------------+---------------------+---------------------|&lt;/span&gt;
&lt;span style=&#34;color: #888888&#34;&gt;|    1 | Should create task for example |            1 | 2016-09-21 03:28:59 | 2016-09-21 03:28:59 |&lt;/span&gt;
&lt;span style=&#34;color: #888888&#34;&gt;+------+--------------------------------+--------------+---------------------+---------------------+&lt;/span&gt;
&lt;span style=&#34;color: #888888&#34;&gt;SELECT 1&lt;/span&gt;
&lt;span style=&#34;color: #888888&#34;&gt;Time: 0.003s&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/p&gt;

&lt;p&gt;And for bad data we can obtain next results:&lt;/p&gt;

&lt;div class=&#34;highlight&#34; style=&#34;background: #f8f8f8&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;iex(&lt;span style=&#34;color: #666666&#34;&gt;4&lt;/span&gt;)&lt;span style=&#34;color: #666666&#34;&gt;&amp;gt;&lt;/span&gt; project_params &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; %{&lt;span style=&#34;color: #B8860B&#34;&gt;name&lt;/span&gt;: &lt;span style=&#34;color: #666666&#34;&gt;1&lt;/span&gt;}
%{&lt;span style=&#34;color: #B8860B&#34;&gt;name&lt;/span&gt;: &lt;span style=&#34;color: #666666&#34;&gt;1&lt;/span&gt;}
iex(&lt;span style=&#34;color: #666666&#34;&gt;5&lt;/span&gt;)&lt;span style=&#34;color: #666666&#34;&gt;&amp;gt;&lt;/span&gt; task_params &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; %{&lt;span style=&#34;color: #B8860B&#34;&gt;description&lt;/span&gt;: &lt;span style=&#34;color: #880000&#34;&gt;nil&lt;/span&gt;}
%{&lt;span style=&#34;color: #B8860B&#34;&gt;description&lt;/span&gt;: &lt;span style=&#34;color: #880000&#34;&gt;nil&lt;/span&gt;}
iex(&lt;span style=&#34;color: #666666&#34;&gt;6&lt;/span&gt;)&lt;span style=&#34;color: #666666&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;EctoTransactions.App&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;create_project_with_task(project_params, task_params)

&lt;span style=&#34;color: #666666&#34;&gt;22&lt;/span&gt;:&lt;span style=&#34;color: #666666&#34;&gt;49&lt;/span&gt;:&lt;span style=&#34;color: #666666&#34;&gt;25.863&lt;/span&gt; [debug] &lt;span style=&#34;color: #0000FF&#34;&gt;QUERY&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;OK&lt;/span&gt; db&lt;span style=&#34;color: #666666&#34;&gt;=0.2&lt;/span&gt;ms
begin []

&lt;span style=&#34;color: #666666&#34;&gt;22&lt;/span&gt;:&lt;span style=&#34;color: #666666&#34;&gt;49&lt;/span&gt;:&lt;span style=&#34;color: #666666&#34;&gt;25.865&lt;/span&gt; [debug] &lt;span style=&#34;color: #0000FF&#34;&gt;QUERY&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;OK&lt;/span&gt; db&lt;span style=&#34;color: #666666&#34;&gt;=0.2&lt;/span&gt;ms
rollback []
{&lt;span style=&#34;color: #B8860B&#34;&gt;:error&lt;/span&gt;, &lt;span style=&#34;color: #B8860B&#34;&gt;:project&lt;/span&gt;}

iex(&lt;span style=&#34;color: #666666&#34;&gt;7&lt;/span&gt;)&lt;span style=&#34;color: #666666&#34;&gt;&amp;gt;&lt;/span&gt; project_params &lt;span style=&#34;color: #666666&#34;&gt;=&lt;/span&gt; %{&lt;span style=&#34;color: #B8860B&#34;&gt;name&lt;/span&gt;: &lt;span style=&#34;color: #BB4444&#34;&gt;&amp;quot;Explain ecto transactions&amp;quot;&lt;/span&gt;}
%{&lt;span style=&#34;color: #B8860B&#34;&gt;name&lt;/span&gt;: &lt;span style=&#34;color: #BB4444&#34;&gt;&amp;quot;Explain ecto transactions&amp;quot;&lt;/span&gt;}
iex(&lt;span style=&#34;color: #666666&#34;&gt;8&lt;/span&gt;)&lt;span style=&#34;color: #666666&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;EctoTransactions.App&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;.&lt;/span&gt;create_project_with_task(project_params, task_params)

&lt;span style=&#34;color: #666666&#34;&gt;22&lt;/span&gt;:&lt;span style=&#34;color: #666666&#34;&gt;49&lt;/span&gt;:&lt;span style=&#34;color: #666666&#34;&gt;53.345&lt;/span&gt; [debug] &lt;span style=&#34;color: #0000FF&#34;&gt;QUERY&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;OK&lt;/span&gt; db&lt;span style=&#34;color: #666666&#34;&gt;=0.3&lt;/span&gt;ms queue&lt;span style=&#34;color: #666666&#34;&gt;=0.1&lt;/span&gt;ms
begin []

&lt;span style=&#34;color: #666666&#34;&gt;22&lt;/span&gt;:&lt;span style=&#34;color: #666666&#34;&gt;49&lt;/span&gt;:&lt;span style=&#34;color: #666666&#34;&gt;53.346&lt;/span&gt; [debug] &lt;span style=&#34;color: #0000FF&#34;&gt;QUERY&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;OK&lt;/span&gt; db&lt;span style=&#34;color: #666666&#34;&gt;=1.2&lt;/span&gt;ms
&lt;span style=&#34;color: #0000FF&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;INTO&lt;/span&gt; &lt;span style=&#34;color: #BB4444&#34;&gt;&amp;quot;projects&amp;quot;&lt;/span&gt; (&lt;span style=&#34;color: #BB4444&#34;&gt;&amp;quot;name&amp;quot;&lt;/span&gt;,&lt;span style=&#34;color: #BB4444&#34;&gt;&amp;quot;inserted_at&amp;quot;&lt;/span&gt;,&lt;span style=&#34;color: #BB4444&#34;&gt;&amp;quot;updated_at&amp;quot;&lt;/span&gt;) &lt;span style=&#34;color: #0000FF&#34;&gt;VALUES&lt;/span&gt; (&lt;span style=&#34;border: 1px solid #FF0000&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;1&lt;/span&gt;,&lt;span style=&#34;border: 1px solid #FF0000&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;2&lt;/span&gt;,&lt;span style=&#34;border: 1px solid #FF0000&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;3&lt;/span&gt;) &lt;span style=&#34;color: #0000FF&#34;&gt;RETURNING&lt;/span&gt; &lt;span style=&#34;color: #BB4444&#34;&gt;&amp;quot;id&amp;quot;&lt;/span&gt; [&lt;span style=&#34;color: #BB4444&#34;&gt;&amp;quot;Explain ecto transactions&amp;quot;&lt;/span&gt;, {{&lt;span style=&#34;color: #666666&#34;&gt;2016&lt;/span&gt;, &lt;span style=&#34;color: #666666&#34;&gt;9&lt;/span&gt;, &lt;span style=&#34;color: #666666&#34;&gt;21&lt;/span&gt;}, {&lt;span style=&#34;color: #666666&#34;&gt;3&lt;/span&gt;, &lt;span style=&#34;color: #666666&#34;&gt;49&lt;/span&gt;, &lt;span style=&#34;color: #666666&#34;&gt;53&lt;/span&gt;, &lt;span style=&#34;color: #666666&#34;&gt;0&lt;/span&gt;}}, {{&lt;span style=&#34;color: #666666&#34;&gt;2016&lt;/span&gt;, &lt;span style=&#34;color: #666666&#34;&gt;9&lt;/span&gt;, &lt;span style=&#34;color: #666666&#34;&gt;21&lt;/span&gt;}, {&lt;span style=&#34;color: #666666&#34;&gt;3&lt;/span&gt;, &lt;span style=&#34;color: #666666&#34;&gt;49&lt;/span&gt;, &lt;span style=&#34;color: #666666&#34;&gt;53&lt;/span&gt;, &lt;span style=&#34;color: #666666&#34;&gt;0&lt;/span&gt;}}]
&lt;span style=&#34;color: #008800; font-style: italic&#34;&gt;#Ecto.Changeset&amp;lt;action: :insert, changes: %{},&lt;/span&gt;
 &lt;span style=&#34;color: #B8860B&#34;&gt;errors&lt;/span&gt;: [&lt;span style=&#34;color: #B8860B&#34;&gt;description&lt;/span&gt;: {&lt;span style=&#34;color: #BB4444&#34;&gt;&amp;quot;can&amp;#39;t be blank&amp;quot;&lt;/span&gt;, []}], &lt;span style=&#34;color: #B8860B&#34;&gt;data&lt;/span&gt;: &lt;span style=&#34;color: #008800; font-style: italic&#34;&gt;#EctoTransactions.Task&amp;lt;&amp;gt;,&lt;/span&gt;
 &lt;span style=&#34;color: #B8860B&#34;&gt;valid?&lt;/span&gt;: &lt;span style=&#34;color: #880000&#34;&gt;false&lt;/span&gt;&lt;span style=&#34;color: #666666&#34;&gt;&amp;gt;&lt;/span&gt;

&lt;span style=&#34;color: #666666&#34;&gt;22&lt;/span&gt;:&lt;span style=&#34;color: #666666&#34;&gt;49&lt;/span&gt;:&lt;span style=&#34;color: #666666&#34;&gt;53.348&lt;/span&gt; [debug] &lt;span style=&#34;color: #0000FF&#34;&gt;QUERY&lt;/span&gt; &lt;span style=&#34;color: #0000FF&#34;&gt;OK&lt;/span&gt; db&lt;span style=&#34;color: #666666&#34;&gt;=0.2&lt;/span&gt;ms
rollback []
{&lt;span style=&#34;color: #B8860B&#34;&gt;:error&lt;/span&gt;, &lt;span style=&#34;color: #B8860B&#34;&gt;:task&lt;/span&gt;}
iex(&lt;span style=&#34;color: #666666&#34;&gt;9&lt;/span&gt;)&lt;span style=&#34;color: #666666&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;If you read with attention you will see two tupples &lt;code&gt;{:error, :project}&lt;/code&gt; and &lt;code&gt;{:error, :task}&lt;/code&gt; with this you can make the assumptions that you want, of course you could say a lot more and instead of returning tupples you return other things with more sense for example change &lt;code&gt;:project&lt;/code&gt; or &lt;code&gt;:task&lt;/code&gt; for his respective &lt;code&gt;changeset&lt;/code&gt; and you should see other things.&lt;/p&gt;

&lt;p&gt;By the way when use &lt;code&gt;Repo.transaction&lt;/code&gt; you should return the implicit data (that is the schema you are saving) that&amp;rsquo;s because &lt;code&gt;Repo.transaction&lt;/code&gt; return a tupple consisting of an &lt;code&gt;:ok&lt;/code&gt; atom and the respective last instruction. And if you use &lt;code&gt;Repo.insert&lt;/code&gt; as returning data you will see a tupple of tupple &lt;code&gt;{:ok, {:ok, data}}&lt;/code&gt; or &lt;code&gt;{:ok, {:error, data}}&lt;/code&gt; (thats because the return of an insert is &lt;code&gt;{:ok, data}&lt;/code&gt; or &lt;code&gt;{:error, data}&lt;/code&gt;) and that&amp;rsquo;s why we use &lt;code&gt;Repo.rollback&lt;/code&gt; for forcing a tupple consisting of &lt;code&gt;{:error, reason}&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;That&amp;rsquo;s all folks! I hope this can help you. And remember Good Luck, Have Fun! and GG!&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>